{% extends "base.html" %}

{% block title %}–ì–ª–∞–≤–Ω–∞—è - –ö–æ–Ω–∫—É—Ä—Å–Ω—ã–µ —Å–ø–∏—Å–∫–∏{% endblock %}

{% block content %}
<div class="page-header">
    <h2>üìä –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω–∫—É—Ä—Å–Ω—ã—Ö —Å–ø–∏—Å–∫–æ–≤</h2>
    <p class="subtitle">–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Å–µ—Ö –∞–±–∏—Ç—É—Ä–∏–µ–Ω—Ç–æ–≤ —Å –∫–∞—Å–∫–∞–¥–æ–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤</p>
</div>

<div class="stats-panel">
    <div class="stat-card">
        <div class="stat-value">{{ total_applicants }}</div>
        <div class="stat-label">–í—Å–µ–≥–æ –∞–±–∏—Ç—É—Ä–∏–µ–Ω—Ç–æ–≤</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ with_consent }}</div>
        <div class="stat-label">–° —Å–æ–≥–ª–∞—Å–∏–µ–º</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ last_update or '–ù/–î' }}</div>
        <div class="stat-label">–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è</div>
    </div>
</div>

<!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
<div class="control-panel">
    <div class="control-section">
        <h3>üì§ –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω–∫—É—Ä—Å–Ω—ã—Ö —Å–ø–∏—Å–∫–æ–≤</h3>
        <form method="POST" action="{{ url_for('upload') }}" enctype="multipart/form-data" class="upload-form">
            <div class="form-group">
                <label for="date">–î–∞—Ç–∞ (—Ñ–æ—Ä–º–∞—Ç: –¥–¥_–º–º):</label>
                <input type="text" id="date" name="date" placeholder="01_08" required>
            </div>
            <div class="form-group">
                <label for="file">CSV —Ñ–∞–π–ª:</label>
                <input type="file" id="file" name="file" accept=".csv" required>
            </div>
            <button type="submit" class="btn btn-primary">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
        </form>
    </div>

    <div class="control-section">
        <h3>üßÆ –†–∞—Å—á–µ—Ç –ø—Ä–æ—Ö–æ–¥–Ω—ã—Ö –±–∞–ª–ª–æ–≤</h3>
        <form method="POST" action="{{ url_for('calculate') }}" class="calculate-form">
            <input type="hidden" name="file" value="{{ selected_file }}">
            <p>–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –ø—Ä–æ—Ö–æ–¥–Ω—ã–µ –±–∞–ª–ª—ã –¥–ª—è —Ç–µ–∫—É—â–µ–π –¥–∞—Ç—ã —Å —É—á–µ—Ç–æ–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ –∞–±–∏—Ç—É—Ä–∏–µ–Ω—Ç–æ–≤</p>
            <button type="submit" class="btn btn-success">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –ø—Ä–æ—Ö–æ–¥–Ω—ã–µ –±–∞–ª–ª—ã</button>
        </form>
    </div>
</div>

<!-- –§–∏–ª—å—Ç—Ä—ã –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ -->
<div class="filter-panel">
    <h3>üîç –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</h3>
    <form method="GET" action="{{ url_for('index') }}" class="filter-form">
        <div class="form-row">
            <div class="form-group">
                <label for="file">–î–∞—Ç–∞:</label>
                <select id="file" name="file" onchange="this.form.submit()">
                    {% for f in files %}
                        <option value="{{ f }}" {% if f == selected_file %}selected{% endif %}>{{ f }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group">
                <label for="program_filter">–ü—Ä–æ–≥—Ä–∞–º–º–∞:</label>
                <select id="program_filter" name="program_filter" onchange="this.form.submit()">
                    <option value="all" {% if program_filter == 'all' %}selected{% endif %}>–í—Å–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã</option>
                    {% for code, prog in programs.items() %}
                        <option value="{{ code }}" {% if program_filter == code %}selected{% endif %}>{{ prog.name }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group">
                <label for="sort_by">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:</label>
                <select id="sort_by" name="sort_by" onchange="this.form.submit()">
                    <option value="total_score" {% if sort_by == 'total_score' %}selected{% endif %}>–ü–æ –±–∞–ª–ª–∞–º</option>
                    <option value="id" {% if sort_by == 'id' %}selected{% endif %}>–ü–æ ID</option>
                    <option value="priority" {% if sort_by == 'priority' %}selected{% endif %}>–ü–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É</option>
                </select>
            </div>

            <div class="form-group">
                <label for="order">–ü–æ—Ä—è–¥–æ–∫:</label>
                <select id="order" name="order" onchange="this.form.submit()">
                    <option value="desc" {% if order == 'desc' %}selected{% endif %}>–ü–æ —É–±—ã–≤–∞–Ω–∏—é</option>
                    <option value="asc" {% if order == 'asc' %}selected{% endif %}>–ü–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é</option>
                </select>
            </div>
        </div>
    </form>
</div>

<!-- –¢–∞–±–ª–∏—Ü–∞ –∞–±–∏—Ç—É—Ä–∏–µ–Ω—Ç–æ–≤ -->
<div class="table-container">
    <h3>üìã –°–ø–∏—Å–æ–∫ –∞–±–∏—Ç—É—Ä–∏–µ–Ω—Ç–æ–≤ ({{ applicants|length }} –∑–∞–ø–∏—Å–µ–π)</h3>
    {% if applicants %}
        <div class="table-responsive">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>–ü—Ä–æ–≥—Ä–∞–º–º–∞</th>
                        <th>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</th>
                        <th>–§–∏–∑–∏–∫–∞/–ò–ö–¢</th>
                        <th>–†—É—Å—Å–∫–∏–π —è–∑—ã–∫</th>
                        <th>–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞</th>
                        <th>–î–æ–ø. –±–∞–ª–ª—ã</th>
                        <th>–°—É–º–º–∞ –±–∞–ª–ª–æ–≤</th>
                        <th>–°–æ–≥–ª–∞—Å–∏–µ</th>
                    </tr>
                </thead>
                <tbody>
                    {% for applicant in applicants %}
                        <tr class="{% if applicant.has_consent %}with-consent{% endif %}">
                            <td><strong>{{ applicant.id }}</strong></td>
                            <td>
                                <span class="program-badge program-{{ applicant.program_code }}">
                                    {{ applicant.program_name }}
                                </span>
                            </td>
                            <td>
                                <span class="priority-badge priority-{{ applicant.priority }}">
                                    {{ applicant.priority }}
                                </span>
                            </td>
                            <td>{{ applicant.physics_ict }}</td>
                            <td>{{ applicant.russian }}</td>
                            <td>{{ applicant.math }}</td>
                            <td>{{ applicant.extra }}</td>
                            <td><strong>{{ applicant.total_score }}</strong></td>
                            <td>
                                {% if applicant.has_consent %}
                                    <span class="consent-badge consent-yes">‚úì –î–∞</span>
                                {% else %}
                                    <span class="consent-badge consent-no">‚úó –ù–µ—Ç</span>
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <div class="empty-state">
            <p>üì≠ –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –∫–æ–Ω–∫—É—Ä—Å–Ω—ã–µ —Å–ø–∏—Å–∫–∏.</p>
        </div>
    {% endif %}
</div>

<!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
<div class="info-panel">
    <h3>‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
    <ul>
        <li><strong>–í—Ä–µ–º—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏:</strong> –ù–µ –±–æ–ª–µ–µ 3 —Å–µ–∫—É–Ω–¥ (—Å–æ–≥–ª–∞—Å–Ω–æ –ø.12 —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π)</li>
        <li><strong>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã:</strong> –û—Ç 1 –¥–æ 4 (1 - –Ω–∞–∏–≤—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)</li>
        <li><strong>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:</strong> –û–ø–µ—Ä–∞—Ü–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–ø–∏—Å–∫–æ–≤ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ –∏—Å–∫–ª—é—á–µ–Ω—ã (—Å–æ–≥–ª–∞—Å–Ω–æ –ø.12)</li>
        <li><strong>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö:</strong> –í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–µ –±–æ–ª–µ–µ 5 —Å–µ–∫—É–Ω–¥ (—Å–æ–≥–ª–∞—Å–Ω–æ –ø.3)</li>
    </ul>
</div>

{% endblock %}
