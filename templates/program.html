{% extends "base.html" %}

{% block title %}{{ program_name }} - –ö–æ–Ω–∫—É—Ä—Å–Ω—ã–µ —Å–ø–∏—Å–∫–∏{% endblock %}

{% block content %}
<div class="page-header">
    <h2>üìö {{ program_name }}</h2>
    <p class="subtitle">–ö–æ–Ω–∫—É—Ä—Å–Ω—ã–µ —Å–ø–∏—Å–∫–∏ –ø–æ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ</p>
</div>

<div class="program-info-panel">
    <div class="stat-card">
        <div class="stat-value">{{ seats }}</div>
        <div class="stat-label">–ë—é–¥–∂–µ—Ç–Ω—ã—Ö –º–µ—Å—Ç</div>
    </div>
    <div class="stat-card {% if passing_score %}stat-success{% else %}stat-warning{% endif %}">
        <div class="stat-value">{{ passing_score if passing_score else '–ù–ï–î–û–ë–û–†' }}</div>
        <div class="stat-label">–ü—Ä–æ—Ö–æ–¥–Ω–æ–π –±–∞–ª–ª</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ applicants|length }}</div>
        <div class="stat-label">–ê–±–∏—Ç—É—Ä–∏–µ–Ω—Ç–æ–≤</div>
    </div>
</div>

<!-- –§–∏–ª—å—Ç—Ä—ã -->
<div class="filter-panel">
    <h3>üîç –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è</h3>
    <form method="GET" action="{{ url_for('program_page', code=program_code) }}" class="filter-form">
        <div class="form-row">
            <div class="form-group">
                <label for="file">–î–∞—Ç–∞:</label>
                <select id="file" name="file" onchange="this.form.submit()">
                    {% for f in files %}
                        <option value="{{ f }}" {% if f == selected_file %}selected{% endif %}>{{ f }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group">
                <label for="sort_by">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:</label>
                <select id="sort_by" name="sort_by" onchange="this.form.submit()">
                    <option value="total_score" {% if sort_by == 'total_score' %}selected{% endif %}>–ü–æ –±–∞–ª–ª–∞–º</option>
                    <option value="priority" {% if sort_by == 'priority' %}selected{% endif %}>–ü–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É</option>
                </select>
            </div>

            <div class="form-group">
                <label for="order">–ü–æ—Ä—è–¥–æ–∫:</label>
                <select id="order" name="order" onchange="this.form.submit()">
                    <option value="desc" {% if order == 'desc' %}selected{% endif %}>–ü–æ —É–±—ã–≤–∞–Ω–∏—é</option>
                    <option value="asc" {% if order == 'asc' %}selected{% endif %}>–ü–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é</option>
                </select>
            </div>
        </div>
    </form>
</div>

<!-- –¢–∞–±–ª–∏—Ü–∞ –∞–±–∏—Ç—É—Ä–∏–µ–Ω—Ç–æ–≤ -->
<div class="table-container">
    <h3>üìã –°–ø–∏—Å–æ–∫ –∞–±–∏—Ç—É—Ä–∏–µ–Ω—Ç–æ–≤ ({{ applicants|length }} –∑–∞–ø–∏—Å–µ–π)</h3>
    {% if applicants %}
        <div class="table-responsive">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>‚Ññ</th>
                        <th>ID</th>
                        <th>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</th>
                        <th>–§–∏–∑–∏–∫–∞/–ò–ö–¢</th>
                        <th>–†—É—Å—Å–∫–∏–π —è–∑—ã–∫</th>
                        <th>–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞</th>
                        <th>–î–æ–ø. –±–∞–ª–ª—ã</th>
                        <th>–°—É–º–º–∞ –±–∞–ª–ª–æ–≤</th>
                        <th>–°–æ–≥–ª–∞—Å–∏–µ</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                    </tr>
                </thead>
                <tbody>
                    {% set ns = namespace(consent_count=0) %}
                    {% for applicant in applicants %}
                        {% if applicant.has_consent %}
                            {% set ns.consent_count = ns.consent_count + 1 %}
                        {% endif %}
                        <tr class="{% if applicant.has_consent %}with-consent{% endif %} 
                                   {% if applicant.has_consent and ns.consent_count <= seats %}enrolled{% endif %}">
                            <td>{{ loop.index }}</td>
                            <td><strong>{{ applicant.id }}</strong></td>
                            <td>
                                <span class="priority-badge priority-{{ applicant.priority }}">
                                    {{ applicant.priority }}
                                </span>
                            </td>
                            <td>{{ applicant.physics_ict }}</td>
                            <td>{{ applicant.russian }}</td>
                            <td>{{ applicant.math }}</td>
                            <td>{{ applicant.extra }}</td>
                            <td><strong>{{ applicant.total_score }}</strong></td>
                            <td>
                                {% if applicant.has_consent %}
                                    <span class="consent-badge consent-yes">‚úì –î–∞</span>
                                {% else %}
                                    <span class="consent-badge consent-no">‚úó –ù–µ—Ç</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if applicant.has_consent and ns.consent_count <= seats %}
                                    <span class="status-badge status-enrolled">üéì –ó–∞—á–∏—Å–ª–µ–Ω</span>
                                {% elif applicant.has_consent %}
                                    <span class="status-badge status-waiting">‚è≥ –í —Ä–µ–∑–µ—Ä–≤–µ</span>
                                {% else %}
                                    <span class="status-badge status-not-enrolled">‚Äî –ù–µ –∑–∞—á–∏—Å–ª–µ–Ω</span>
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <div class="empty-state">
            <p>üì≠ –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.</p>
        </div>
    {% endif %}
</div>

<!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ—Ö–æ–¥–Ω–æ–º –±–∞–ª–ª–µ -->
<div class="info-panel">
    <h3>‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ—Ö–æ–¥–Ω–æ–º –±–∞–ª–ª–µ</h3>
    <p><strong>–ü—Ä–æ—Ö–æ–¥–Ω–æ–π –±–∞–ª–ª</strong> —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Å —É—á–µ—Ç–æ–º:</p>
    <ul>
        <li>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º, –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∞–±–∏—Ç—É—Ä–∏–µ–Ω—Ç–∞–º–∏</li>
        <li>–¢–æ–ª—å–∫–æ –∞–±–∏—Ç—É—Ä–∏–µ–Ω—Ç–æ–≤, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏–≤—à–∏—Ö —Å–æ–≥–ª–∞—Å–∏–µ –æ –∑–∞—á–∏—Å–ª–µ–Ω–∏–∏</li>
        <li>–ö–æ–ª–∏—á–µ—Å—Ç–≤–∞ –±—é–¥–∂–µ—Ç–Ω—ã—Ö –º–µ—Å—Ç: <strong>{{ seats }}</strong></li>
    </ul>
    {% if passing_score %}
        <p class="highlight">
            üí° –ü—Ä–æ—Ö–æ–¥–Ω–æ–π –±–∞–ª–ª: <strong>{{ passing_score }}</strong> 
            (–±–∞–ª–ª –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞—á–∏—Å–ª–µ–Ω–Ω–æ–≥–æ –∞–±–∏—Ç—É—Ä–∏–µ–Ω—Ç–∞)
        </p>
    {% else %}
        <p class="highlight warning">
            ‚ö†Ô∏è –ù–ï–î–û–ë–û–† - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–±–∏—Ç—É—Ä–∏–µ–Ω—Ç–æ–≤ —Å —Å–æ–≥–ª–∞—Å–∏–µ–º –º–µ–Ω—å—à–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –º–µ—Å—Ç
        </p>
    {% endif %}
</div>

<div class="action-buttons">
    <a href="{{ url_for('index') }}" class="btn btn-secondary">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –æ–±—â–µ–º—É —Å–ø–∏—Å–∫—É</a>
</div>

{% endblock %}
